\subsubsection{ARM: \OptimizingKeil + \ThumbMode}

\begin{lstlisting}
.text:00000000 ; Segment type: Pure code
.text:00000000                 AREA .text, CODE
...
.text:00000000 main
.text:00000000                 PUSH    {R4,LR}
.text:00000002                 ADR     R0, aEnterX     ; "Enter X:\n"
.text:00000004                 BL      __2printf
.text:00000008                 LDR     R1, =x
.text:0000000A                 ADR     R0, aD          ; "%d"
.text:0000000C                 BL      __0scanf
.text:00000010                 LDR     R0, =x
.text:00000012                 LDR     R1, [R0]
.text:00000014                 ADR     R0, aYouEnteredD___ ; "You entered %d...\n"
.text:00000016                 BL      __2printf
.text:0000001A                 MOVS    R0, #0
.text:0000001C                 POP     {R4,PC}
...
.text:00000020 aEnterX         DCB "Enter X:",0xA,0    ; DATA XREF: main+2
.text:0000002A                 DCB    0
.text:0000002B                 DCB    0
.text:0000002C off_2C          DCD x                   ; DATA XREF: main+8
.text:0000002C                                         ; main+10
.text:00000030 aD              DCB "%d",0              ; DATA XREF: main+A
.text:00000033                 DCB    0
.text:00000034 aYouEnteredD___ DCB "You entered %d...",0xA,0 ; DATA XREF: main+14
.text:00000047                 DCB 0
.text:00000047 ; .text         ends
.text:00000047
...
.data:00000048 ; Segment type: Pure data
.data:00000048                 AREA .data, DATA
.data:00000048                 ; ORG 0x48
.data:00000048                 EXPORT x
.data:00000048 x               DCD 0xA                 ; DATA XREF: main+8
.data:00000048                                         ; main+10
.data:00000048 ; .data         ends
\end{lstlisting}

Итак, переменная \TT{x} теперь глобальная, и она расположена, почему-то, в другом сегменте данных (\IT{.data}). 
Можно спросить, почему текстовые строки расположены в сегменте кода (\IT{.text}) а \TT{x} нельзя было разместить
тут же? Потому что эта переменная, и как следует из определения, она может меняться. Сегмент кода нередко может 
быть расположен в ПЗУ микроконтроллера (не забывайте, мы сейчас имеем дело с embedded-микроэлектроникой),
а изменяемые переменные --- в ОЗУ.
Нередко, ОЗУ дороже чем ПЗУ, так что хранить в нем неизменяемые данные, когда в наличии есть ПЗУ, не экономно.

Далее, мы видим, в сегменте кода, хранится указатель на переменную \TT{x} (\TT{off\_2C}) и вообще, все операции 
с ним, происходят через этот указатель.
Это связано с тем что переменная \TT{x} может быть расположена где-то довольно далеко от данного участка кода
и её адрес нужно сохранить в переменной рядом с кодом.
Инструкция \TT{LDR} в thumb-режиме может адресовать только переменные в пределах вплоть до 1020 байт от места
где она находится. Эта же инструкция в ARM-режиме --- переменные в пределах $\pm{}4095$, таким образом, 
адрес глобальной переменной \TT{x} нужно иметь где-то рядом, ведь нет никакой гарантии, что саму переменную
получится хранить где-то рядом, она может быть даже в другом чипе памяти!

Еще одна вещь: если переменную объявить как \IT{const}, то компилятор Keil разместит её в сегменте \TT{.constdata}.
Должно быть, впоследствии, линкер и этот сегмент сможет разместить в ПЗУ.

