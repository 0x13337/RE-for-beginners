\subsubsection{ARM + \OptimizingKeil + \ARMMode}

\begin{lstlisting}[caption=\OptimizingKeil + \ARMMode]
02 0C C0 E3          BIC     R0, R0, #0x200
01 09 80 E3          ORR     R0, R0, #0x4000
1E FF 2F E1          BX      LR
\end{lstlisting}

\index{ARM!\Instructions!BIC}
\index{ARM!\Instructions!ORR}
\TT{BIC} \IFRU{это ``логическое и'', аналог}{is ``logical and'', analogical to} \ANDIns \In x86.
\TT{ORR} \IFRU{это ``логическое или'', аналог}{is ``logical or'', analogical to} \OR \In x86.

\IFRU{Пока всё понятно}{So far, so easy}.

\subsubsection{ARM + \OptimizingKeil + \ThumbMode}

\begin{lstlisting}[caption=\OptimizingKeil + \ThumbMode]
01 21 89 03          MOVS    R1, 0x4000
08 43                ORRS    R0, R1
49 11                ASRS    R1, R1, #5   ; generate 0x200 and place to R1
88 43                BICS    R0, R1
70 47                BX      LR
\end{lstlisting}

\IFRU{Вероятно, Keil решил что код в режиме thumb}
{Apparently, Keil concludes the code in thumb mode},
\IFRU{получающий}{making} \TT{0x200} \IFRU{из}{from} \TT{0x4000}, 
\IFRU{будет компактнее нежели код}{will be more compact than code}, 
\IFRU{записывающий}{writting} \TT{0x200} \IFRU{в какой-нибудь регистр}{to arbitrary register}.

\index{ARM!\Instructions!ASRS}
\IFRU{Поэтому, при помощи инструкции}
{So that is why, with the help of} \TT{ASRS} 
(\ASRdesc), \IFRU{это значение вычисляется как}{this value is calculating as} $\TT{0x4000} \gg 5$.

\subsubsection{ARM + \OptimizingXcode + \ARMMode}
\label{anomaly:LLVM}
\index{\CompilerAnomaly}

\begin{lstlisting}[caption=\OptimizingXcode + \ARMMode]
42 0C C0 E3          BIC             R0, R0, #0x4200
01 09 80 E3          ORR             R0, R0, #0x4000
1E FF 2F E1          BX              LR
\end{lstlisting}

\IFRU{Код, который был сгенерирован LLVM, в исходном коде, на самом деле, выглядел бы так:}
{The code was generated by LLVM, in source code form, in fact, could be looks like:}

\begin{lstlisting}
    REMOVE_BIT (rt, 0x4200);
    SET_BIT (rt, 0x4000);
\end{lstlisting}

\IFRU{И он делает то же самое что нам нужно}{And it does exactly the same we need}. 
\IFRU{Но почему}{But why} \TT{0x4200}? 
\IFRU{Возможно, это артефакт оптимизатора LLVM}
{Perhaps, that is the LLVM optimizer's artifact}
\footnote{\IFRU{Это был}{It was} LLVM build 2410.2.00 \IFRU{входящий в состав}{bundled with} Apple Xcode 4.6.3}.
\IFRU{Возможно, ошибка оптимизатора компилятора, но создаваемый код все же работает верно.}
{Probably, compiler's optimizer error, but generated code works correct anyway.}

\IFRU{Об аномалиях компиляторов, подробнее читайте здесь}
{More about compiler's anomalies, read here}~\ref{anomaly:Intel}.

\IFRU{Для режима Thumb}{For thumb mode}, \OptimizingXcode \IFRU{генерирует точно такой же код}{generates
exactly the same code}.

